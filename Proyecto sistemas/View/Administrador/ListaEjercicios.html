<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Lista de Ejercicios (Administrador)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../Ejercicio/css/indexadmin.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .table thead th {
      background-color: #316163 !important;
      color: #fff !important;
    }
  </style>
</head>

<body>

  <!-- Header, men칰 lateral y footer los genera MenuEntren.js -->

  <!-- CONTENIDO PRINCIPAL -->
  <main class="contenedor-main" id="mainContent">

    <div class="container mt-5">
      <h2 class="mb-4">Ejercicios registrados</h2>
      <div id="alertPlaceholder">
        <div class="d-flex justify-content-end">
          <button class="btn btn-volver" onclick="window.location.href='../../View/Administrador/Index.html'">Regresar
            al
            Men칰</button>
          <button class="btn btn-sm btn-enviar" onclick="window.location.href='../Ejercicio/indexEjercicio.html'">
            <i class="bi bi-plus-circle"></i>Agregar

          </button>
        </div>
      </div>

      <!-- Filtro de b칰squeda -->
      <div class="input-group mb-3" style="max-width: 350px;">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input type="text" class="form-control" id="filtroEjercicio" placeholder="Buscar por nombre de ejercicio">
      </div>

      <!-- Tabla con scroll horizontal -->
      <div class="tabla-scroll mb-2">
        <table class="table table-striped align-middle" id="tablaEjercicios">
          <thead class="table-primary">
            <tr>
              <th>Nombre</th>
              <th>Descripci칩n</th>
              <th>Repeticiones</th>
              <th>Gu칤a</th>
              <th>츼rea Muscular</th>
              <th>츼rea Muscular Afectada</th>
              <th>Dificultad</th>
              <!-- 游뛂 NO hay columna "Acciones" -->
            </tr>
          </thead>
          <tbody>
            <!-- Aqu칤 se insertar치n los ejercicios -->
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <!-- Scripts principales -->
  <script type="module">
    import { renderAdminLayout } from "../../Controler/Administrador/AdminLayout.js";
    renderAdminLayout();
  </script>
  <script type="module" src="../../Controler/Administrador/ejercicioFuncionesAdmin.js"></script>

  <!-- Filtro de b칰squeda y scroll funcional -->
  <script>
    let listaEjerciciosGlobal = [];

    function renderizarTablaEjercicios(filtro = "") {
      const table = document.getElementById("tablaEjercicios");
      if (!table) return;
      const tbody = table.querySelector("tbody");
      if (!tbody) return;

      let ejerciciosFiltrados = listaEjerciciosGlobal;

      if (filtro) {
        ejerciciosFiltrados = listaEjerciciosGlobal.filter(ej =>
          ej.Nombre && ej.Nombre.toLowerCase().includes(filtro.toLowerCase())
        );
      }

      if (!Array.isArray(ejerciciosFiltrados) || ejerciciosFiltrados.length === 0) {
        tbody.innerHTML =
          "<tr><td colspan='7'>No hay ejercicios registrados.</td></tr>";
        return;
      }

      tbody.innerHTML = "";
      ejerciciosFiltrados.forEach((ej) => {
        tbody.insertAdjacentHTML(
          "beforeend",
          `
          <tr>
            <td>${ej.Nombre}</td>
            <td>${ej.Descripcion}</td>
            <td>${ej.Repeticiones}</td>
            <td><a href="${ej.GuiaEjercicio}" target="_blank">Ver video</a></td>
            <td>${ej.AreaMuscular}</td>
            <td>${ej.AreaMuscularAfectada}</td>
            <td>${ej.Dificultad}</td>
          </tr>
          `
        );
      });
    }

    // Busca y renderiza al escribir en el filtro
    document.addEventListener("DOMContentLoaded", function () {
      const filtroInput = document.getElementById("filtroEjercicio");
      if (filtroInput) {
        filtroInput.addEventListener("input", function () {
          renderizarTablaEjercicios(this.value);
        });
      }
    });

    // Sobrescribe o envuelve la funci칩n de cargar (ajusta el URL_API seg칰n corresponda)
    window.cargarEjerciciosAdmin = async function cargarEjerciciosAdmin() {
      const URL_API = typeof window.URL_API !== "undefined" ? window.URL_API : ""; // Ajusta si tienes la URL global
      const table = document.getElementById("tablaEjercicios");
      if (!table) return;
      const tbody = table.querySelector("tbody");
      if (!tbody) return;

      tbody.innerHTML = "<tr><td colspan='7'>Cargando...</td></tr>";

      try {
        const resp = await fetch(`${URL_API}/listaEjercicios`);
        if (!resp.ok) throw new Error("No se pudo obtener la lista");
        const ejercicios = await resp.json();

        let lista = [];
        if (Array.isArray(ejercicios)) {
          lista = ejercicios;
        } else if (Array.isArray(ejercicios.$values)) {
          lista = ejercicios.$values;
        } else if (Array.isArray(ejercicios.data)) {
          lista = ejercicios.data;
        } else if (Array.isArray(ejercicios.lista)) {
          lista = ejercicios.lista;
        } else {
          console.warn("Formato inesperado de la respuesta:", ejercicios);
        }

        listaEjerciciosGlobal = lista;
        renderizarTablaEjercicios();

      } catch (err) {
        if (typeof mostrarMensaje === "function") {
          mostrarMensaje("Error al cargar ejercicios: " + err.message, "danger");
        }
        tbody.innerHTML = "<tr><td colspan='7'>Error al cargar datos.</td></tr>";
      }
    };

    // Llama la funci칩n al cargar la p치gina (si no la llama otro m칩dulo)
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof window.cargarEjerciciosAdmin === "function") {
        window.cargarEjerciciosAdmin();
      }
    });
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>

</html>